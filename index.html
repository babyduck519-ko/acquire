<html>
<head>
  <meta charset="UTF-8">
  <title>Acquire Hotel Status v1.0</title>
  <style>
    th { font-size:xxx-large; }
    td, button {
      font-size:xx-large;
      text-align:center;
      vertical-align: middle;
    }
    td, th {
      border:2px solid black;
    }
    button {
      width:10%;
      height:20%;
    }
    img { vertical-align: middle; }
    .status { font-size:2.5vh }
    .outlined
    {
      text-shadow:
        2px 2px 3px white,    /* 오른쪽 아래 그림자 */
        -2px -2px 3px white,  /* 왼쪽 위 그림자 */
        2px -2px 3px white,   /* 오른쪽 위 그림자 */
        -2px 2px 3px white;   /* 왼쪽 아래 그림자 */
    }
    #selection
    {
      position:absolute;
      left:20%;
      width:60%;
      height:40%;
      top:20%;
    }
  </style>
  <script>
    var isClassicMode = true;
    var hotelNames = ["색슨", "타워", "아메리칸", "페스티벌", "월드와이드", "콘티넨털", "임페리얼"];
    var hotelColors = ["f43b38", "bb9f03", "3d4dbc", "00aeb5", "842d95", "0898e2", "fa882d"];
    var currentChainSizes = new Array(hotelNames.length);
    for( var i = 0; i < currentChainSizes.length; i++ )
      currentChainSizes[i] = 1;

    var chainAdjuster = [ 0, 0, 1, 1, 1, 2, 2 ];
    var chainSizes = [2, 3, 4, 5, 6, 11, 21, 31, 41];
    var secondBonuses = [ 1500, 2200, 3000, 3700, 4200, 5000, 5700, 6200, 7000, 7700, 8200 ];

    function getCurrentStockValue( hotelID )
    {
      var stockValues = [ 0, 0, 0, 0 ];
      var valueIndex = 0;
      for( ; valueIndex < chainSizes.length; valueIndex++ )
        if( currentChainSizes[hotelID] < chainSizes[valueIndex] ) break;
      valueIndex--;

      if( valueIndex >= 0 )
      {
        stockValues[0] = ( valueIndex + chainAdjuster[hotelID] + 2 ) * 100;
        stockValues[1] = stockValues[0] * 10;
        stockValues[2] = isClassicMode ? stockValues[1] / 2 : secondBonuses[valueIndex + chainAdjuster[hotelID]];
        stockValues[3] = isClassicMode ? 0 : stockValues[1] / 2;
      }
      return stockValues;
    }

    function appear()
    {
      document.getElementById("result").style.opacity = opa++ / 100;
      if( opa < 100 ) setTimeout( appear, 25 );
      else setTimeout( confirm, 2000 );
    }

    function init()
    {
      var hotelStatus = document.getElementsByName("hotelStatus");
      for( var i = 0; i < hotelNames.length; i++ )
      {
        hotelStatus[i].innerHTML = "<button onclick='updateSize(" + i + ", -1)'>-</button> ";
        hotelStatus[i].innerHTML += "<img style='height:7vh' src='acquire_pics/" + i + ".png' onclick='merge(" + i + ")'/> ";
        hotelStatus[i].innerHTML += "<button onclick='updateSize(" + i + ", 1)'>+</button> &nbsp; ";
        // hotelStatus[i].innerHTML += "<button onclick='merge(" + i + ")'>M</button>";
        hotelStatus[i].innerHTML += "<div name='status' class='status'></div>";
      }
      toggleMode();

    }

    function toggleMode()
    {
      isClassicMode = !isClassicMode;
      document.getElementById("isClassic").innerText = isClassicMode ? "클래식 모드" : "재벌가 모드";
    }

    function updateSize( hotelID, bias )
    {
      currentChainSizes[ hotelID ] = currentChainSizes[ hotelID ] + bias;
      if( currentChainSizes[ hotelID ] < 1 ) currentChainSizes[ hotelID ] = 1;
      updateStatus( hotelID );
    }

    function updateStatus( hotelID )
    {
      var hotelStatus = document.getElementsByName("status");
      var stockValues = getCurrentStockValue( hotelID );
      if( currentChainSizes[hotelID] < 2 ) hotelStatus[hotelID].innerText = "";
      else {
        hotelStatus[hotelID].innerHTML = "현재 크기[" + currentChainSizes[hotelID] + "] " +
                                         "가격[$" + stockValues[0] + "]<br/>주주 보너스";
        hotelStatus[hotelID].innerHTML += " [$" + stockValues[1] + "], [$" + stockValues[2] + "]";
        if(stockValues[3] > 0 ) hotelStatus[hotelID].innerHTML += ", [$" + stockValues[3] + "]";

        if( currentChainSizes[hotelID] > 10 )
        {
          hotelStatus[hotelID].innerHTML = "<span class='outlined' style='color:#" + hotelColors[hotelID] + "'>"
          + hotelStatus[hotelID].innerHTML + "</span>";
        }
     }
    }

    function merge( hotelID )
    {
      if( currentChainSizes[hotelID] < 2 ) alert("호텔을 먼저 설립하세요!");
      else if( currentChainSizes[hotelID] > 10 ) alert("안정된 호텔은 합병될 수 없습니다!");
      else {
        var candidateList = new Array();
        for( var i = 0; i < hotelNames.length; i++ )
          if( currentChainSizes[i] >= 2 && i != hotelID )
            candidateList.push( i );

        if( candidateList.length == 0 ) alert("합병할 호텔이 없습니다!");
        else {
          var selectionWindow = document.getElementById("selection");
          selectionWindow.style.display = "inline";
          var candidates = document.getElementById("candidates");
          candidates.innerHTML = "";

          for( var i = 0; i < candidateList.length; i++ )
            candidates.innerHTML += "<img style='width:15%' src='acquire_pics/" + candidateList[i] + ".png' onclick='mergeTo(" + candidateList[i] + ", " + hotelID + ")'/> ";
        }
      }
    }

    function mergeTo( biggerHotel, smallerHotel )
    {
      if( confirm( hotelNames[smallerHotel] + " 호텔을 " + hotelNames[biggerHotel] + " 호텔과 합병하시겠습니까?") )
      {
        currentChainSizes[biggerHotel] += currentChainSizes[smallerHotel] + 1;
        currentChainSizes[smallerHotel] = 1;
        alert( hotelNames[smallerHotel] + " 호텔과 " + hotelNames[biggerHotel] + " 호텔이 합병되었습니다!" );
        updateStatus(biggerHotel);
        updateStatus(smallerHotel);
        disappear();
      }
    }

    function disappear()
    {
      document.getElementById("selection").style.display = "none";
    }
  </script>
</head>
<body onload="init()" background="acquire_pics/bg.jpg" style="background-color:#cce2e1;background-size: 100% auto;background-repeat: no-repeat;">
  <!-- <body onload="init()" background="acquire_pics/bg.jpg" onbeforeunload="return false;" style="background-color:#cce2e1;background-size: 100% auto;background-repeat: no-repeat;"> -->
    <div id="selection" style="display:none">
      <table style="width:100%;height:100%;background-color:white">
        <tr style="height:10%"><th>합병할 호텔을 선택하세요</th></tr>
        <tr><td><div id="candidates"></div></td></tr>
        <tr style="height:10%"><td><button style="width:30%;height:80%" onclick="disappear()">취소</button></td></tr>
      </table>
    </div>
    <table style="width:100%;height:100%">
      <tr style="height:7%"><th colspan="2">어콰이어 호텔 현황판</th></tr>
      <tr style="height:23.25%">
        <td width="50%"><div name="hotelStatus"></div></td>
        <td width="50%"><div name="hotelStatus"></div></td>
      </tr>
      <tr style="height:23.25%">
        <td width="50%"><div name="hotelStatus"></div></td>
        <td width="50%"><div name="hotelStatus"></div></td>
      </tr>
      <tr style="height:23.25%">
        <td width="50%"><div name="hotelStatus"></div></td>
        <td width="50%"><div name="hotelStatus"></div></td>
      </tr>
      <tr style="height:23.25%">
        <td width="50%"><div name="hotelStatus"></div></td>
        <td width="50%"><div id="isClassic" onclick="toggleMode()"></div></td>
      </tr>
      </table>
  </body>
</html>
